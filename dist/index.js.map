{"version":3,"file":"index.js","sources":["../src/utils/isVisible.ts","../src/utils/throttle.ts","../src/ScrollSpy/ScrollSpy.tsx"],"sourcesContent":["// to check if the element is in viewport\nexport const isVisible = (el: HTMLElement) => {\n  const rectInView = el.getBoundingClientRect();\n\n  // this decides how much of the element should be visible\n  const leniency = window.innerHeight * 0.5;\n\n  return (\n    rectInView.top + leniency >= 0 &&\n    rectInView.bottom - leniency <= window.innerHeight\n  );\n};\n","export const throttle = (callback: () => void, limit: number) => {\n  var tick = false;\n\n  return () => {\n    if (!tick) {\n      callback();\n      tick = true;\n      setTimeout(function () {\n        tick = false;\n      }, limit);\n    }\n  };\n};\n","import * as React from \"react\";\nimport {\n  MutableRefObject,\n  ReactNode,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { isVisible } from \"../utils/isVisible\";\nimport { throttle } from \"../utils/throttle\";\n\ninterface ScrollSpyProps {\n  children: ReactNode;\n  navContainerRef?: MutableRefObject<HTMLDivElement | null>;\n  scrollThrottle?: number;\n}\n\nconst ScrollSpy = ({\n  children,\n  navContainerRef,\n  scrollThrottle = 300,\n}: ScrollSpyProps) => {\n  const scrollContainerRef = useRef<HTMLDivElement | null>(null);\n  const [navContainerItems, setNavContainerItems] = useState<NodeListOf<Element> | undefined>(); // prettier-ignore\n\n  // keeps track of the Id in navcontainer which is active\n  // so as to not update classLists unless it has been updated\n  const prevIdTracker = useRef(\"\");\n\n  // To get the nav container items depending on whether the parent ref for the nav container is passed or not\n  useEffect(() => {\n    if (navContainerRef) {\n      setNavContainerItems(\n        navContainerRef.current?.querySelectorAll(\"[data-to-scrollspy-id]\")\n      );\n    } else {\n      setNavContainerItems(document.querySelectorAll(\"[data-to-scrollspy-id]\"));\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [navContainerRef]);\n\n  // fire once after nav container items are set\n  useEffect(() => {\n    checkAndUpdateActiveScrollSpy();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [navContainerItems]);\n\n  const checkAndUpdateActiveScrollSpy = () => {\n    const scrollParentContainer = scrollContainerRef.current;\n\n    // if there are no children, return\n    if (!(scrollParentContainer && navContainerItems)) return;\n\n    // loop over all children in scroll container\n    for (let i = 0; i < scrollParentContainer.children.length; i++) {\n      // get child element\n      const child = scrollParentContainer.children.item(i);\n      if (!child) continue;\n      const useChild = child as HTMLDivElement;\n\n      // check if the element is in the viewport\n      if (isVisible(useChild)) {\n        // if so, get its ID\n        const changeHighlightedItemId = useChild.id;\n\n        // if the element was same as the one currently active ignore it\n        if (prevIdTracker.current === changeHighlightedItemId) return;\n\n        // now loop over each element in the nav Container\n        navContainerItems.forEach((el) => {\n          const attrId = el.getAttribute(\"data-to-scrollspy-id\");\n\n          // if the element contains 'active' the class remove it\n          if (el.classList.contains(\"active-scroll-spy\")) {\n            el.classList.remove(\"active-scroll-spy\");\n          }\n\n          // check if its ID matches the ID we got from the viewport\n          // also make sure it does not already contain the 'active' class\n          if (\n            attrId === changeHighlightedItemId &&\n            !el.classList.contains(\"active-scroll-spy\")\n          ) {\n            el.classList.add(\"active-scroll-spy\");\n\n            prevIdTracker.current = changeHighlightedItemId;\n            window.history.pushState({}, \"\", `#${changeHighlightedItemId}`);\n          }\n        });\n        break;\n      }\n    }\n  };\n\n  window.addEventListener(\n    \"scroll\",\n    throttle(checkAndUpdateActiveScrollSpy, scrollThrottle)\n  );\n\n  return <div ref={scrollContainerRef}>{children}</div>;\n};\n\nexport default ScrollSpy;\n"],"names":["useRef","useState","useEffect","React"],"mappings":"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"}