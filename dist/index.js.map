{"version":3,"file":"index.js","sources":["../src/utils/throttle.ts","../src/ScrollSpy/ScrollSpy.tsx"],"sourcesContent":["export const throttle = (callback: () => void, limit: number) => {\r\n  var tick = false;\r\n\r\n  return () => {\r\n    if (!tick) {\r\n      callback();\r\n      tick = true;\r\n      setTimeout(function () {\r\n        tick = false;\r\n      }, limit);\r\n    }\r\n  };\r\n};\r\n","import * as React from \"react\";\r\nimport {\r\n  MutableRefObject,\r\n  ReactNode,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { throttle } from \"../utils/throttle\";\r\n\r\ninterface ScrollSpyProps {\r\n  children: ReactNode;\r\n\r\n  // refs\r\n  navContainerRef?: MutableRefObject<HTMLDivElement | null>;\r\n  parentScrollContainerRef?: MutableRefObject<HTMLDivElement | null>;\r\n\r\n  // throttle\r\n  scrollThrottle?: number;\r\n\r\n  // callback\r\n  onUpdateCallback?: (id: string) => void;\r\n\r\n  // offsets\r\n  offsetTop?: number;\r\n  offsetBottom?: number;\r\n\r\n  // customize attributes\r\n  useDataAttribute?: string;\r\n  activeClass?: string;\r\n\r\n  useBoxMethod?: boolean;\r\n  updateHistoryStack?: boolean;\r\n}\r\n\r\nconst ScrollSpy = ({\r\n  children,\r\n\r\n  // refs\r\n  navContainerRef,\r\n  parentScrollContainerRef,\r\n\r\n  // throttle\r\n  scrollThrottle = 300,\r\n\r\n  // callback\r\n  onUpdateCallback,\r\n\r\n  // offsets\r\n  offsetTop = 0,\r\n  offsetBottom = 0,\r\n\r\n  // customize attributes\r\n  useDataAttribute = \"to-scrollspy-id\",\r\n  activeClass = \"active-scroll-spy\",\r\n\r\n  useBoxMethod = true,\r\n  updateHistoryStack = true,\r\n}: ScrollSpyProps) => {\r\n  const scrollContainerRef = useRef<HTMLDivElement | null>(null);\r\n  const [navContainerItems, setNavContainerItems] = useState<NodeListOf<Element> | undefined>(); // prettier-ignore\r\n\r\n  // keeps track of the Id in navcontainer which is active\r\n  // so as to not update classLists unless it has been updated\r\n  const prevIdTracker = useRef(\"\");\r\n\r\n  // To get the nav container items depending on whether the parent ref for the nav container is passed or not\r\n  useEffect(() => {\r\n    navContainerRef\r\n      ? setNavContainerItems(\r\n          navContainerRef.current?.querySelectorAll(\r\n            `[data-${useDataAttribute}]`\r\n          )\r\n        )\r\n      : setNavContainerItems(\r\n          document.querySelectorAll(`[data-${useDataAttribute}]`)\r\n        );\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [navContainerRef]);\r\n\r\n  // fire once after nav container items are set\r\n  useEffect(() => {\r\n    checkAndUpdateActiveScrollSpy();\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [navContainerItems]);\r\n\r\n  const isVisible = (el: HTMLElement) => {\r\n    const rectInView = el.getBoundingClientRect();\r\n\r\n    if (useBoxMethod) {\r\n      const useHeight = parentScrollContainerRef?.current\r\n        ? parentScrollContainerRef?.current.offsetHeight\r\n        : window.innerHeight;\r\n      const hitbox_top = useHeight;\r\n      const element_top = rectInView.top;\r\n      const element_bottom = rectInView.top + useHeight;\r\n\r\n      return (\r\n        hitbox_top < element_bottom + offsetBottom &&\r\n        hitbox_top > element_top - offsetTop\r\n      );\r\n    } else {\r\n      // this decides how much of the element should be visible\r\n      const leniency = parentScrollContainerRef?.current\r\n        ? parentScrollContainerRef?.current.offsetHeight * 0.5\r\n        : window.innerHeight * 0.5;\r\n\r\n      const useHeight = parentScrollContainerRef?.current\r\n        ? parentScrollContainerRef?.current.offsetHeight\r\n        : window.innerHeight;\r\n\r\n      return (\r\n        rectInView.top + leniency + offsetTop >= 0 &&\r\n        rectInView.bottom - leniency - offsetBottom <= useHeight\r\n      );\r\n    }\r\n  };\r\n\r\n  const checkAndUpdateActiveScrollSpy = () => {\r\n    const scrollParentContainer = scrollContainerRef.current;\r\n\r\n    // if there are no children, return\r\n    if (!(scrollParentContainer && navContainerItems)) return;\r\n\r\n    // loop over all children in scroll container\r\n    for (let i = 0; i < scrollParentContainer.children.length; i++) {\r\n      // get child element\r\n      const useChild = scrollParentContainer.children.item(i) as HTMLDivElement;\r\n\r\n      const elementIsVisible = isVisible(useChild);\r\n\r\n      // check if the element is in the viewport\r\n      if (elementIsVisible) {\r\n        // if so, get its ID\r\n        const changeHighlightedItemId = useChild.id;\r\n\r\n        // if the element was same as the one currently active ignore it\r\n        if (prevIdTracker.current === changeHighlightedItemId) return;\r\n\r\n        // now loop over each element in the nav Container\r\n        navContainerItems.forEach((el) => {\r\n          const attrId = el.getAttribute(`data-${useDataAttribute}`);\r\n\r\n          // if the element contains 'active' the class remove it\r\n          if (el.classList.contains(activeClass)) {\r\n            el.classList.remove(activeClass);\r\n          }\r\n\r\n          // check if its ID matches the ID we got from the viewport\r\n          // also make sure it does not already contain the 'active' class\r\n          if (\r\n            attrId === changeHighlightedItemId &&\r\n            !el.classList.contains(activeClass)\r\n          ) {\r\n            el.classList.add(activeClass);\r\n\r\n            if (onUpdateCallback) {\r\n              onUpdateCallback(changeHighlightedItemId);\r\n            }\r\n\r\n            prevIdTracker.current = changeHighlightedItemId;\r\n            if (updateHistoryStack){\r\n              window.history.pushState({}, \"\", `#${changeHighlightedItemId}`);\r\n            }\r\n          }\r\n        });\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n  // listen for scroll event\r\n  parentScrollContainerRef\r\n  ? // if ref for scrollable div is provided\r\n    parentScrollContainerRef.current?.addEventListener(\r\n      \"scroll\",\r\n      throttle(checkAndUpdateActiveScrollSpy, scrollThrottle)\r\n    )\r\n  : // else listen for scroll in window\r\n    window.addEventListener(\r\n      \"scroll\",\r\n      throttle(checkAndUpdateActiveScrollSpy, scrollThrottle)\r\n    );\r\n  })\r\n\r\n  return <div ref={scrollContainerRef}>{children}</div>;\r\n};\r\n\r\nexport default ScrollSpy;\r\n"],"names":["useRef","useState","useEffect","React"],"mappings":"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"}